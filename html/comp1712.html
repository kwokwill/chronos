<!DOCTYPE html>

<html lang="en">

<head>
  <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.0.3/firebase-firestore.js"></script>
  <meta charset="utf-8">
  <title>COMP 1712</title>
  <meta name="COMP 1930 LOADING PAGE" content="listing assignments in course">
  <meta name="William, Adam, Charlie" content="Chronos">

  <!-- Bootstrap for Mobile-first -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

  <!-- Optional styles and scripts of your own -->
  <!-- <link rel="stylesheet" href="styles/style.css">-->
  <!-- <script src="scripts/script.js"></script>-->
  <style>
    .testing {
      width: 92%;
      height: 100px;
      align-content: center;
      margin-left: 10px;
      margin-bottom: 5px;
      border-radius: 5px;
      background-color: lightblue;
      border: solid black 1px;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Chronos</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Course View</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Calendar View</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Settings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Log Out</a>
        </li>
      </ul>
    </div>
  </nav>
  
  <div id="titleBar" style="text-align: center"> COMP 1712 </div>
  <div class="list-group">
    <ul id="COMP1930-list"></ul>
  </div>
  <script src="https://www.gstatic.com/firebasejs/7.2.3/firebase-analytics.js"></script>
  <script>
    // Initialize Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyDxcuP8iqbfPbtYPwAFh04xEc3SZ-JlNqs",
      authDomain: "chronos-c7366.firebaseapp.com",
      databaseURL: "https://chronos-c7366.firebaseio.com",
      projectId: "chronos-c7366",
      storageBucket: "chronos-c7366.appspot.com",
      messagingSenderId: "821932163722",
      appId: "1:821932163722:web:7531781e1df6f497342373"
    };
    // Initialize Firebase


    firebase.initializeApp(firebaseConfig);

    const db = firebase.firestore();
    const settings = {
      /* your settings... */
      timestampsInSnapshots: true
    };


    db.settings({
      timestampsInSnapshots: true
    });

  </script>
  <script>
    const workList = document.querySelector('.list-group');

    function renderWork(doc) {
      let li = document.createElement('a');
      li.classList.add("testing", "list-group-item", "list-group-item-action", "flex-column", "align-items-start");
      let name = document.createElement('div');
      let dueDate = document.createElement('p');
      let cross = document.createElement('div');

      var stringMonth = doc.data().dueDate + '';
      var res = stringMonth.split("-"); // turn the date into a list format (Split by / if needed)
      var months = ["Jan", "Feb", "March", "April", "May", "June", "July",
        "August", "September", "October", "November", "December"
      ];

      dueDate.textContent = (months[res[1] - 1] + " " + [res[2]] + ", " + [res[0]]);

      li.setAttribute('data-id', doc.id);
      name.textContent = doc.data().name;

      li.appendChild(name);
      li.appendChild(dueDate);
      li.appendChild(cross);

      workList.appendChild(li);

      // deleting data
      cross.addEventListener('click', (e) => {
        e.stopPropagation();
        let id = e.target.parentElement.getAttribute('data-id');
        db.collection('COMP1930').doc(id).delete();
      });
    }
    // real-time listener


db.collection("COMP1930").orderBy("dueDate", "desc").onSnapshot(snapshot => {
    let changes = snapshot.docChanges();
    changes.forEach(change => {

        console.log(change.doc.data());

        if (change.type == 'added') {
          renderWork(change.doc);

        } else if (change.type == 'removed') {
          let li = workList.querySelector('[data-id=' + change.doc.id + ']');
          workList.removeChild(li);
        }
      });

    });

  </script>

</body>

</html>
